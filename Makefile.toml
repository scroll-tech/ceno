[env]
CARGO_MAKE_EXTEND_WORKSPACE_MAKEFILE = true
CORE = { script = ["nproc"] }
RAYON_NUM_THREADS = "${CORE}"
CUR_TARGET = { script = ['''
        if [ -z "${TARGET}" ]; then
            TARGET=$(rustc -vV | grep "host" | awk '{print $2}')
            echo "${TARGET}"
        else
            echo "${TARGET}"
        fi
        '''] }

[tasks.tests]
workspace = false
command = "cargo"
args = [
    "test",
    "--lib",
    "--release",
    "--target",
    "${CUR_TARGET}",
    "--workspace",
    "--exclude",
    "ceno_rt",
    "--exclude",
    "singer-pro",
]

[tasks.fmt-all-check]
workspace = false
command = "cargo"
args = ["fmt", "--all", "--", "--check"]

[tasks.fmt-all]
workspace = false
command = "cargo"
args = ["fmt", "--all"]

[tasks.clippy-all]
workspace = false
command = "cargo"
args = ["clippy", "--all-features", "--all-targets", "--", "-D", "warnings"]

[tasks.fmt]
workspace = false
command = "cargo"
args = ["fmt", "-p", "ceno_zkvm", "--", "--check"]

[tasks.clippy]
workspace = false
command = "cargo"
args = [
    "clippy",
    "--package",
    "ceno_zkvm",
    "--package",
    "mpcs",
    "--package",
    "ceno_emul",
    "--package",
    "ceno_rt",
    "--target",
    "${CUR_TARGET}",
    "--",
    "-D",
    "warnings",
]
